name: Update TMD Forecast Data to Google Drive
on:
schedule:
- cron: '0 14 * * *' # รันทุกวันเวลา 14:00 UTC (21:00 เวลาไทย)
workflow_dispatch:

jobs:
update-data:
runs-on: ubuntu-latest

steps:
  - name: Checkout repository
    uses: actions/checkout@v3

  - name: Set up Python
    uses: actions/setup-python@v4
    with:
      python-version: '3.10'

  - name: Install dependencies
    run: |
      python -m pip install --upgrade pip
      if [ -f requirements.txt ]; then pip install -r requirements.txt; fi

  - name: Set timezone to Bangkok
    run: sudo timedatectl set-timezone Asia/Bangkok

  - name: Run plume_location.py
    run: python scrap1.py

  - name: Upload tmd_7day_forecast_today.csv to Google Drive
    uses: mathisve/gdrive-upload-action@main
    with:
      filename: tmd_7day_forecast_today.csv
      name: tmd_7day_forecast_today.csv
      folderId: ${{ secrets.GOOGLE_ID }}
      credentials: ${{ secrets.SERVICE_ID }}
      encoded: false
